{"version":2,"kind":"Notebook","sha256":"52a99efc719598eb4a940a2a5b26f87e3242ab8a22336c3a0286cffd7f250ead","slug":"notebooks.simplified-calc.climkern-calc","location":"/notebooks/simplified-calc/climkern-calc.ipynb","dependencies":[],"frontmatter":{"title":"Feedbacks with ClimKern","content_includes_title":true,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"authors":[{"nameParsed":{"literal":"Project Pythia Community","given":"Project Pythia","family":"Community"},"name":"Project Pythia Community","url":"https://projectpythia.org/","id":"contributors-myst-generated-uid-0"}],"open_access":true,"license":{"content":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true},"code":{"id":"Apache-2.0","url":"https://opensource.org/licenses/Apache-2.0","name":"Apache License 2.0","free":true,"osi":true}},"github":"https://github.com/projectpythia/radiative-feedback-cookbook","copyright":"2024","affiliations":[{"id":"UAlbany","name":"University at Albany (SUNY)","department":"Atmospheric and Environmental Sciences","url":"https://www.albany.edu/daes"},{"id":"CISL","name":"NSF National Center for Atmospheric Research","department":"Computational and Information Systems Lab","url":"https://www.cisl.ucar.edu"},{"id":"Unidata","name":"NSF Unidata","url":"https://www.unidata.ucar.edu"},{"id":"Argonne","name":"Argonne National Laboratory","department":"Environmental Science Division","url":"https://www.anl.gov/evs"},{"id":"CarbonPlan","name":"CarbonPlan","url":"https://carbonplan.org"},{"id":"NVIDIA","name":"NVIDIA Corporation","url":"https://www.nvidia.com/"}],"numbering":{"title":{"offset":1}},"edit_url":"https://github.com/projectpythia/radiative-feedback-cookbook/blob/main/notebooks/simplified-calc/climkern-calc.ipynb","thumbnail":"/radiative-feedback-cookbook/build/ClimKern-logo-4db88b8cdf5e3e5b10e894ccecda8acb.png","exports":[{"format":"ipynb","filename":"climkern-calc.ipynb","url":"/radiative-feedback-cookbook/build/climkern-calc-2e9a719d396405603f9a73640dc0de4d.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"image","url":"/radiative-feedback-cookbook/build/ClimKern-logo-4db88b8cdf5e3e5b10e894ccecda8acb.png","alt":"ClimKern Python Package Logo","width":250,"key":"kHvbpgFCs9","urlSource":"../images/logos/ClimKern-logo.png"}],"key":"d37vTpsXrq"}],"key":"sysFircgzb"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Feedbacks with ClimKern","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NwWBeIHdsY"}],"identifier":"feedbacks-with-climkern","label":"Feedbacks with ClimKern","html_id":"feedbacks-with-climkern","implicit":true,"key":"k6GKFQCuwp"}],"key":"v0hjZ8eUZx"},{"type":"block","kind":"notebook-content","children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OQbg2u2aNU"}],"key":"GBKsJt5Mhb"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Overview","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RX3fRnxw3P"}],"identifier":"overview","label":"Overview","html_id":"overview","implicit":true,"key":"kTeGgQUvmA"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"While it is good to know how to manually calculate radiative feedbacks, it is also time-consuming to constantly recreate the code. Here, we will use a new Python package called ClimKern that offers functions to calculate radiative feedbacks from climate model or reanalysis output. The advantages of using ClimKern go beyond making it simpler—it standardizes the methods and assumptions that go into these sometimes complicated calculations. We will use CMIP6 output in this notebook. You will learn how to:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Gn1DaG33jQ"}],"key":"VBZPphPhNI"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Download CMIP6 data from Pangeo’s space on Google Cloud.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"MXA5zUX2pQ"}],"key":"CGKv0ilSzK"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Obtain a radiative kernel from the ClimKern repository.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"LxkihmkcWG"}],"key":"YC7xl72YQi"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Calculate the surface albedo, temperature, and water vapor feedbacks.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"gls8aTw0XE"}],"key":"ScYydcHmFO"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Compute the cloud feedbacks using the two main methods: residual and adjustment.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"ZFi4r1ooru"}],"key":"biX3CVTH3P"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Quantify stratospheric feedbacks.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"W5yD2Hownr"}],"key":"KsR4G8Gokb"}],"key":"VqFHMl8TEi"}],"key":"tkKY44TMkB"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Prerequisites","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"osm792SavG"}],"identifier":"prerequisites","label":"Prerequisites","html_id":"prerequisites","implicit":true,"key":"PInxQgiQs1"},{"type":"table","position":{"start":{"line":3,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"tableRow","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"tableCell","header":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Concepts","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"QIY9uep2LA"}],"key":"whm3Nqy61t"},{"type":"tableCell","header":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Importance","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jWFgSOULQY"}],"key":"gsDXRDR8u7"},{"type":"tableCell","header":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Notes","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Eho6fI45If"}],"key":"d1F1H2XspK"}],"key":"Wt1ocm02BA"},{"type":"tableRow","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"link","url":"https://foundations.projectpythia.org/core/xarray/xarray-intro.html","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Intro to Xarray","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"iga4nWgu4D"}],"urlSource":"https://foundations.projectpythia.org/core/xarray/xarray-intro.html","key":"CczblQdGIo"}],"key":"N3ommy2S4x"},{"type":"tableCell","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Necessary","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"eYOt4z6via"}],"key":"l1h12mH88d"},{"type":"tableCell","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[],"key":"MSjyR1MWpl"}],"key":"X4YwbRyg7a"},{"type":"tableRow","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"link","url":"https://foundations.projectpythia.org/core/cartopy/cartopy.html","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Intro to Cartopy","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"ZX7VJvoysW"}],"urlSource":"https://foundations.projectpythia.org/core/cartopy/cartopy.html","key":"PkxI8eif8b"}],"key":"ufLVkdSDUw"},{"type":"tableCell","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Necessary","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"CSguiKIzap"}],"key":"D6aVEEOTAu"},{"type":"tableCell","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[],"key":"kJwXskFvcj"}],"key":"wSCfMoxITw"},{"type":"tableRow","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"link","url":"https://foundations.projectpythia.org/core/matplotlib/matplotlib-basics.html","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Intro to Matplotlib","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"uorpHaddkO"}],"urlSource":"https://foundations.projectpythia.org/core/matplotlib/matplotlib-basics.html","key":"TBzXL6q15B"}],"key":"uOPcMhWz0o"},{"type":"tableCell","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Helpful","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"Qdl3f8sZzX"}],"key":"ngjtj331fe"},{"type":"tableCell","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[],"key":"FSSs50RFmf"}],"key":"gClhbw3JOV"},{"type":"tableRow","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"link","url":"https://projectpythia.org/cmip6-cookbook/notebooks/foundations/intake-esm.html","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Loading CMIP6 Data with Intake-ESM","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"MBvedDWuf1"}],"urlSource":"https://projectpythia.org/cmip6-cookbook/notebooks/foundations/intake-esm.html","key":"wfTxhkZheJ"}],"key":"kv3eeWlJog"},{"type":"tableCell","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Helpful","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"bmtEmZ8zZn"}],"key":"EptPC0UCMj"},{"type":"tableCell","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[],"key":"Iv8sBhMQZ9"}],"key":"u5QyngSo4e"}],"key":"pQvOwUnb1h"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"strong","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Time to learn","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"roXA72Hzw5"}],"key":"ibEb3wOeax"},{"type":"text","value":": 20 minutes","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"lLoGKWoBhw"}],"key":"eOfMHJ4rBe"}],"key":"xFUJK1RgAR"}],"key":"Y5WImMab3N"},{"type":"block","kind":"notebook-content","children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KUs7Jg1DWo"}],"key":"Bh2mv0QMYM"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Imports","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jV3m5gHk3o"}],"identifier":"imports","label":"Imports","html_id":"imports","implicit":true,"key":"gxru3CfUoW"}],"key":"khX5Ln163U"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import climkern as ck\nimport intake\nimport matplotlib.pyplot as plt\nimport s3fs\nimport fsspec\nimport xarray as xr\nimport glob\nimport importlib.util\nimport os\nimport cartopy.crs as ccrs\n\n%matplotlib inline\nplt.rcParams[\"figure.dpi\"] = 100","key":"n6XYcA8hym"},{"type":"output","id":"FIwDuq7wjN7i6_q4B6kdQ","data":[],"key":"b97xSzevZz"}],"key":"tR68EqrUXG"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Download the kernel","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mR69nArSfQ"}],"identifier":"download-the-kernel","label":"Download the kernel","html_id":"download-the-kernel","implicit":true,"key":"ilM0VwBCkW"}],"key":"tOxHTeaUGV"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Normally, when ClimKern is installed, the user needs to download data on the command\nline from the Zenodo repository. However, we now have the data on Jetstream2, so\nwe can download it from there and save it in our package repository.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NxIAiBl6cD"}],"key":"v0myet18J6"},{"type":"div","class":"admonition alert alert-info","children":[{"type":"paragraph","children":[{"type":"text","value":"Future update","key":"ojY5fmKNCz"}],"key":"NqAP5Kwt4n"},{"type":"text","value":"Future versions of ClimKern will be able to pull the kernel from Jetstream2 without storing locally.","key":"kloqZ4YDYC"}],"key":"QE40Dj7ucv"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"First, set the URL and path to point to ClimKern. Also, specify which kernel you want.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"JlugZCR0Ka"}],"key":"fOv1EL3NxX"}],"key":"BUaRHVnh5h"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"URL = \"https://js2.jetstream-cloud.org:8001/\" # URL for jetstream access\npath = f\"pythia/ClimKern\" # Location of ClimKern\nkernel = \"ERA5\"","key":"YUR8kGUQcF"},{"type":"output","id":"Zwd84TKaR0_D2VPlujzvM","data":[],"key":"zXzJ6Qeabd"}],"key":"vXqFdybiGH"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Next, read in the data from Jetstream2","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NIwlXRFonq"}],"key":"hGp96DYwHb"}],"key":"WlAgYikwzS"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Read in data\n# Set up access to jetstream2\nfs = fsspec.filesystem(\"s3\", anon=True, client_kwargs=dict(endpoint_url=URL))\npattern = f\"s3://{path}/kernels/\"+kernel+f\"/TOA*.nc\"\n\n# Grab the data\nfiles = sorted(fs.glob(pattern))\n\n# Open file and make it Xarray Dataset\nkern = xr.open_dataset(fs.open(files[0]))\n\n# Save path for later\npath_out = files[0].split(kernel+\"/\",1)[1]","key":"KZhqhWympW"},{"type":"output","id":"vouzY4n9urq8kiKAssWr0","data":[{"output_type":"error","traceback":"\u001b[31m---------------------------------------------------------------------------\u001b[39m\n\u001b[31mAttributeError\u001b[39m                            Traceback (most recent call last)\n\u001b[36mCell\u001b[39m\u001b[36m \u001b[39m\u001b[32mIn[3]\u001b[39m\u001b[32m, line 7\u001b[39m\n\u001b[32m      4\u001b[39m pattern = \u001b[33mf\u001b[39m\u001b[33m\"\u001b[39m\u001b[33ms3://\u001b[39m\u001b[38;5;132;01m{\u001b[39;00mpath\u001b[38;5;132;01m}\u001b[39;00m\u001b[33m/kernels/\u001b[39m\u001b[33m\"\u001b[39m+kernel+\u001b[33mf\u001b[39m\u001b[33m\"\u001b[39m\u001b[33m/TOA*.nc\u001b[39m\u001b[33m\"\u001b[39m\n\u001b[32m      6\u001b[39m \u001b[38;5;66;03m# Grab the data\u001b[39;00m\n\u001b[32m----> \u001b[39m\u001b[32m7\u001b[39m files = \u001b[38;5;28msorted\u001b[39m(\u001b[43mfs\u001b[49m\u001b[43m.\u001b[49m\u001b[43mglob\u001b[49m\u001b[43m(\u001b[49m\u001b[43mpattern\u001b[49m\u001b[43m)\u001b[49m)\n\u001b[32m      9\u001b[39m \u001b[38;5;66;03m# Open file and make it Xarray Dataset\u001b[39;00m\n\u001b[32m     10\u001b[39m kern = xr.open_dataset(fs.open(files[\u001b[32m0\u001b[39m]))\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/feedback-cookbook-dev/lib/python3.11/site-packages/fsspec/asyn.py:118\u001b[39m, in \u001b[36msync_wrapper.<locals>.wrapper\u001b[39m\u001b[34m(*args, **kwargs)\u001b[39m\n\u001b[32m    115\u001b[39m \u001b[38;5;129m@functools\u001b[39m.wraps(func)\n\u001b[32m    116\u001b[39m \u001b[38;5;28;01mdef\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34mwrapper\u001b[39m(*args, **kwargs):\n\u001b[32m    117\u001b[39m     \u001b[38;5;28mself\u001b[39m = obj \u001b[38;5;129;01mor\u001b[39;00m args[\u001b[32m0\u001b[39m]\n\u001b[32m--> \u001b[39m\u001b[32m118\u001b[39m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[43msync\u001b[49m\u001b[43m(\u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mloop\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mfunc\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43m*\u001b[49m\u001b[43margs\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43m*\u001b[49m\u001b[43m*\u001b[49m\u001b[43mkwargs\u001b[49m\u001b[43m)\u001b[49m\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/feedback-cookbook-dev/lib/python3.11/site-packages/fsspec/asyn.py:103\u001b[39m, in \u001b[36msync\u001b[39m\u001b[34m(loop, func, timeout, *args, **kwargs)\u001b[39m\n\u001b[32m    101\u001b[39m     \u001b[38;5;28;01mraise\u001b[39;00m FSTimeoutError \u001b[38;5;28;01mfrom\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mreturn_result\u001b[39;00m\n\u001b[32m    102\u001b[39m \u001b[38;5;28;01melif\u001b[39;00m \u001b[38;5;28misinstance\u001b[39m(return_result, \u001b[38;5;167;01mBaseException\u001b[39;00m):\n\u001b[32m--> \u001b[39m\u001b[32m103\u001b[39m     \u001b[38;5;28;01mraise\u001b[39;00m return_result\n\u001b[32m    104\u001b[39m \u001b[38;5;28;01melse\u001b[39;00m:\n\u001b[32m    105\u001b[39m     \u001b[38;5;28;01mreturn\u001b[39;00m return_result\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/feedback-cookbook-dev/lib/python3.11/site-packages/fsspec/asyn.py:56\u001b[39m, in \u001b[36m_runner\u001b[39m\u001b[34m(event, coro, result, timeout)\u001b[39m\n\u001b[32m     54\u001b[39m     coro = asyncio.wait_for(coro, timeout=timeout)\n\u001b[32m     55\u001b[39m \u001b[38;5;28;01mtry\u001b[39;00m:\n\u001b[32m---> \u001b[39m\u001b[32m56\u001b[39m     result[\u001b[32m0\u001b[39m] = \u001b[38;5;28;01mawait\u001b[39;00m coro\n\u001b[32m     57\u001b[39m \u001b[38;5;28;01mexcept\u001b[39;00m \u001b[38;5;167;01mException\u001b[39;00m \u001b[38;5;28;01mas\u001b[39;00m ex:\n\u001b[32m     58\u001b[39m     result[\u001b[32m0\u001b[39m] = ex\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/feedback-cookbook-dev/lib/python3.11/site-packages/fsspec/asyn.py:807\u001b[39m, in \u001b[36mAsyncFileSystem._glob\u001b[39m\u001b[34m(self, path, maxdepth, **kwargs)\u001b[39m\n\u001b[32m    804\u001b[39m     \u001b[38;5;28;01melse\u001b[39;00m:\n\u001b[32m    805\u001b[39m         depth = \u001b[38;5;28;01mNone\u001b[39;00m\n\u001b[32m--> \u001b[39m\u001b[32m807\u001b[39m allpaths = \u001b[38;5;28;01mawait\u001b[39;00m \u001b[38;5;28mself\u001b[39m._find(\n\u001b[32m    808\u001b[39m     root, maxdepth=depth, withdirs=\u001b[38;5;28;01mTrue\u001b[39;00m, detail=\u001b[38;5;28;01mTrue\u001b[39;00m, **kwargs\n\u001b[32m    809\u001b[39m )\n\u001b[32m    811\u001b[39m pattern = glob_translate(path + (\u001b[33m\"\u001b[39m\u001b[33m/\u001b[39m\u001b[33m\"\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m ends_with_sep \u001b[38;5;28;01melse\u001b[39;00m \u001b[33m\"\u001b[39m\u001b[33m\"\u001b[39m))\n\u001b[32m    812\u001b[39m pattern = re.compile(pattern)\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/feedback-cookbook-dev/lib/python3.11/site-packages/s3fs/core.py:558\u001b[39m, in \u001b[36mS3FileSystem._find\u001b[39m\u001b[34m(self, path, maxdepth, withdirs, detail)\u001b[39m\n\u001b[32m    556\u001b[39m     \u001b[38;5;28;01mraise\u001b[39;00m \u001b[38;5;167;01mValueError\u001b[39;00m(\u001b[33m\"\u001b[39m\u001b[33mCannot traverse all of S3\u001b[39m\u001b[33m\"\u001b[39m)\n\u001b[32m    557\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m maxdepth:\n\u001b[32m--> \u001b[39m\u001b[32m558\u001b[39m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28;01mawait\u001b[39;00m \u001b[38;5;28msuper\u001b[39m()._find(\n\u001b[32m    559\u001b[39m         bucket + \u001b[33m\"\u001b[39m\u001b[33m/\u001b[39m\u001b[33m\"\u001b[39m + key, maxdepth=maxdepth, withdirs=withdirs, detail=detail\n\u001b[32m    560\u001b[39m     )\n\u001b[32m    561\u001b[39m \u001b[38;5;66;03m# TODO: implement find from dircache, if all listings are present\u001b[39;00m\n\u001b[32m    562\u001b[39m \u001b[38;5;66;03m# if refresh is False:\u001b[39;00m\n\u001b[32m    563\u001b[39m \u001b[38;5;66;03m#     out = incomplete_tree_dirs(self.dircache, path)\u001b[39;00m\n\u001b[32m   (...)\u001b[39m\u001b[32m    568\u001b[39m \u001b[38;5;66;03m#         return super().find(path)\u001b[39;00m\n\u001b[32m    569\u001b[39m \u001b[38;5;66;03m#     # else: we refresh anyway, having at least two missing trees\u001b[39;00m\n\u001b[32m    570\u001b[39m out = \u001b[38;5;28;01mawait\u001b[39;00m \u001b[38;5;28mself\u001b[39m._lsdir(path, delimiter=\u001b[33m\"\u001b[39m\u001b[33m\"\u001b[39m)\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/feedback-cookbook-dev/lib/python3.11/site-packages/fsspec/asyn.py:847\u001b[39m, in \u001b[36mAsyncFileSystem._find\u001b[39m\u001b[34m(self, path, maxdepth, withdirs, **kwargs)\u001b[39m\n\u001b[32m    843\u001b[39m detail = kwargs.pop(\u001b[33m\"\u001b[39m\u001b[33mdetail\u001b[39m\u001b[33m\"\u001b[39m, \u001b[38;5;28;01mFalse\u001b[39;00m)\n\u001b[32m    845\u001b[39m \u001b[38;5;66;03m# Add the root directory if withdirs is requested\u001b[39;00m\n\u001b[32m    846\u001b[39m \u001b[38;5;66;03m# This is needed for posix glob compliance\u001b[39;00m\n\u001b[32m--> \u001b[39m\u001b[32m847\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m withdirs \u001b[38;5;129;01mand\u001b[39;00m path != \u001b[33m\"\u001b[39m\u001b[33m\"\u001b[39m \u001b[38;5;129;01mand\u001b[39;00m \u001b[38;5;28;01mawait\u001b[39;00m \u001b[38;5;28mself\u001b[39m._isdir(path):\n\u001b[32m    848\u001b[39m     out[path] = \u001b[38;5;28;01mawait\u001b[39;00m \u001b[38;5;28mself\u001b[39m._info(path)\n\u001b[32m    850\u001b[39m \u001b[38;5;66;03m# async for?\u001b[39;00m\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/feedback-cookbook-dev/lib/python3.11/site-packages/s3fs/core.py:1021\u001b[39m, in \u001b[36mS3FileSystem._isdir\u001b[39m\u001b[34m(self, path)\u001b[39m\n\u001b[32m   1018\u001b[39m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28;01mFalse\u001b[39;00m\n\u001b[32m   1020\u001b[39m \u001b[38;5;66;03m# This only returns things within the path and NOT the path object itself\u001b[39;00m\n\u001b[32m-> \u001b[39m\u001b[32m1021\u001b[39m \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28mbool\u001b[39m(\u001b[38;5;28;01mawait\u001b[39;00m \u001b[38;5;28mself\u001b[39m._lsdir(path))\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/feedback-cookbook-dev/lib/python3.11/site-packages/s3fs/core.py:509\u001b[39m, in \u001b[36mS3FileSystem._lsdir\u001b[39m\u001b[34m(self, path, refresh, max_items, delimiter)\u001b[39m\n\u001b[32m    507\u001b[39m \u001b[38;5;28;01mtry\u001b[39;00m:\n\u001b[32m    508\u001b[39m     logger.debug(\u001b[33m\"\u001b[39m\u001b[33mGet directory listing page for \u001b[39m\u001b[38;5;132;01m%s\u001b[39;00m\u001b[33m\"\u001b[39m % path)\n\u001b[32m--> \u001b[39m\u001b[32m509\u001b[39m     \u001b[38;5;28;01mawait\u001b[39;00m \u001b[38;5;28mself\u001b[39m._connect()\n\u001b[32m    510\u001b[39m     pag = \u001b[38;5;28mself\u001b[39m.s3.get_paginator(\u001b[33m\"\u001b[39m\u001b[33mlist_objects_v2\u001b[39m\u001b[33m\"\u001b[39m)\n\u001b[32m    511\u001b[39m     config = {}\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/feedback-cookbook-dev/lib/python3.11/site-packages/s3fs/core.py:365\u001b[39m, in \u001b[36mS3FileSystem._connect\u001b[39m\u001b[34m(self, refresh, kwargs)\u001b[39m\n\u001b[32m    363\u001b[39m     config_kwargs[\u001b[33m\"\u001b[39m\u001b[33msignature_version\u001b[39m\u001b[33m\"\u001b[39m] = UNSIGNED\n\u001b[32m    364\u001b[39m conf = AioConfig(**config_kwargs)\n\u001b[32m--> \u001b[39m\u001b[32m365\u001b[39m \u001b[38;5;28mself\u001b[39m.session = \u001b[43maiobotocore\u001b[49m\u001b[43m.\u001b[49m\u001b[43mAioSession\u001b[49m(**\u001b[38;5;28mself\u001b[39m.kwargs)\n\u001b[32m    366\u001b[39m s3creator = \u001b[38;5;28mself\u001b[39m.session.create_client(\n\u001b[32m    367\u001b[39m     \u001b[33m\"\u001b[39m\u001b[33ms3\u001b[39m\u001b[33m\"\u001b[39m, config=conf, **init_kwargs, **client_kwargs\n\u001b[32m    368\u001b[39m )\n\u001b[32m    369\u001b[39m \u001b[38;5;28mself\u001b[39m._s3creator = s3creator\n\n\u001b[31mAttributeError\u001b[39m: module 'aiobotocore' has no attribute 'AioSession'","ename":"AttributeError","evalue":"module 'aiobotocore' has no attribute 'AioSession'"}],"key":"VUkY1nzLZV"}],"key":"NoA4mePGbJ"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"To save this data in ClimKern’s directory, we have to figure out where it is on the\nmachine. After that, we will go ahead and save out the kernel as a netCDF in\nClimKern’s local data directory.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HXQDQ3G9Xk"}],"key":"Ti4cNB1y39"}],"key":"DRVEWK4iAi"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Get the package location\nspec = importlib.util.find_spec(\"climkern\")\npackage_dir = os.path.dirname(spec.origin)\n\n# print(f\"The package directory is: {package_dir}\")\n\n# Define the path where you want to save the netCDF file within the package directory\nnetcdf_path = os.path.join(package_dir,\"data/kernels\",kernel,path_out)\n\n# Ensure the directory exists\nos.makedirs(os.path.dirname(netcdf_path), exist_ok=True)\n\n# Save the dataset as a netCDF file\nkern.to_netcdf(netcdf_path)","key":"iAcBiwYiXr"},{"type":"output","id":"KOntrOmTkNyi2Gljhpec8","data":[],"key":"BmgxFdTkg0"}],"key":"vUFXMIjCMF"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now, let’s just make sure we can retrieve the kernel.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MOZnLLaX77"}],"key":"MSFFbjJd7j"}],"key":"ut1TF80fWE"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ck.util.get_kern(kernel)","key":"pYHqDt7GBf"},{"type":"output","id":"MhVVi7jb6sWmFCyC-98gO","data":[],"key":"w0gXtfTDvD"}],"key":"Fjnl82nFvL"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Prepare the CMIP6 Data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qefH11gJLR"}],"identifier":"prepare-the-cmip6-data","label":"Prepare the CMIP6 Data","html_id":"prepare-the-cmip6-data","implicit":true,"key":"eUIlZDAiQi"}],"key":"YrFQMmhX18"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"To start, we will need some CMIP6 data to calculate feedbacks. We will use the\npreindustrial control and 4×CO","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"H0v1TZlYE3"},{"type":"inlineMath","value":"_2","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow></mrow><mn>2</mn></msub></mrow><annotation encoding=\"application/x-tex\">_2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4511em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"QIvfNxqxLX"},{"type":"text","value":" experiments from just one model (CESM2).","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"j8y1PViHgY"}],"key":"gU1tqdAaft"}],"key":"VIqHty6Unw"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Make a list of variables and experiments we need\nvar_list = [\"rsds\",\"rsus\",\"ta\",\"ts\",\"ps\",\"hus\"]\nexp_list = [\"piControl\",\"abrupt-4xCO2\"]\n\n# Specify data location, open it\ncat_url = \"https://storage.googleapis.com/cmip6/pangeo-cmip6.json\"\ncol = intake.open_esm_datastore(cat_url)\n\n# Create a catalog of matching simulations\ncat = col.search(experiment_id=exp_list,source_id=\"CESM2\",variable_id=var_list,\n                table_id=\"Amon\")\n\n# Convert to a dictionary of Xarray Datasets\nds_dict = cat.to_dataset_dict(zarr_kwargs={'consolidated': True})","key":"nfgFVnajx7"},{"type":"output","id":"sK2N_tf0f_M7lcBAlYhLc","data":[],"key":"Ui4F7KeBfQ"}],"key":"kM6vuyCsaO"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"The data, especially the preindustrial control simulation that will serve as our\ncontrol climate, is huge. We are going to only use the last 50 years of the control\nand last 30 years of the abrupt 4×CO","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VTC5ZW8IiD"},{"type":"inlineMath","value":"_2","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow></mrow><mn>2</mn></msub></mrow><annotation encoding=\"application/x-tex\">_2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4511em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"wv8FNWvFRp"},{"type":"text","value":" simulation. There are a few extra coordinates\nand/or dimensions we don’t need, hence the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RBF8cYQkgn"},{"type":"inlineCode","value":"squeeze()","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ueJ8TtpXZ9"},{"type":"text","value":".","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SdU3qCMvzZ"}],"key":"qmCem6g4nB"}],"key":"L95w8XefF1"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Our control simulation\nctrl = ds_dict[\"CMIP.NCAR.CESM2.piControl.Amon.gn\"].isel(\n    time=slice(-600,None)).squeeze().chunk({\"plev\":1,\"time\":-1})\n\n# The increase CO2 aka \"perturbed\" simulation\npert = ds_dict[\"CMIP.NCAR.CESM2.abrupt-4xCO2.Amon.gn\"].isel(\n    time=slice(-360,None)).squeeze().chunk({\"plev\":1,\"time\":-1})","key":"ZBdbzfWYnQ"},{"type":"output","id":"l7Q229_QTunshQ6gzPMA5","data":[],"key":"klJUH1xPnU"}],"key":"Qt2ZafmRGH"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"To save a little diskspace because ClimKern still isn’t dask compatible yet,\nlet’s make our control climatology ahead of time.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tCWPxCsHm3"}],"key":"RGDgX0Oi2j"}],"key":"lJkcxdLeMZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ctrl = ctrl.groupby(ctrl.time.dt.month).mean(dim=\"time\").rename({\"month\":\"time\"})\npert = pert.groupby(pert.time.dt.month).mean(dim=\"time\").rename({\"month\":\"time\"})","key":"xSwRnndYEK"},{"type":"output","id":"FLmiT5VasrzLA6k3ZRGBN","data":[],"key":"gfwWbMrwUg"}],"key":"xWe4wnfmj3"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Feedback calculations","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DOqGb6To2S"}],"identifier":"feedback-calculations","label":"Feedback calculations","html_id":"feedback-calculations","implicit":true,"key":"vefyVi5h4S"}],"key":"qS8dlxm59T"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Calculate surface temperature change","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FmQApoMBXH"}],"identifier":"calculate-surface-temperature-change","label":"Calculate surface temperature change","html_id":"calculate-surface-temperature-change","implicit":true,"key":"N9gu0CNCKx"}],"key":"EGNEPnwbDu"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"ClimKern outputs feedbacks as radiative perturbations at the TOA (because there are multiple ways to quantify feedbacks). One of the most common ways is to normalize by the change in the surface temperature, which puts values in “true” feedback units of W/m","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"o46nrk6u83"},{"type":"inlineMath","value":"^2","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mrow></mrow><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">^2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span>","key":"CcbBZYT9Dv"},{"type":"text","value":"/K. For that, we start by calculating the change in the surface temperature in our CESM2 experiment.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RXOBY6gCZx"}],"key":"npfXd4kj2r"}],"key":"s1EpwXuEkN"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Take difference between pert and ctrl ts fields\nΔts = pert.ts - ctrl.ts","key":"VB6vDhgVRV"},{"type":"output","id":"TRFB1MeYQnofd9r0JlEfi","data":[],"key":"zWjt3hDnVM"}],"key":"op79oTP953"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Surface albedo feedback","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"skf3HPKAKZ"}],"identifier":"surface-albedo-feedback","label":"Surface albedo feedback","html_id":"surface-albedo-feedback","implicit":true,"key":"RKq67GKrHC"}],"key":"yYBPO48fEG"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Perhaps the simplest of the radiative feedbacks to calculate is the surface albedo\nfeedback because it requires only two variables and is a 3-dimensional field (no height\ncoordinate). The variables we will use are as follows:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KXsqOl24Pb"}],"key":"NfmLT4a3iK"},{"type":"table","position":{"start":{"line":5,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"tableRow","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"tableCell","header":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Variable name","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"BgTvUXD0oE"}],"key":"tyxxZk5e0o"},{"type":"tableCell","header":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Description","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"GZuisrB9gY"}],"key":"GJ1QDoHGEU"},{"type":"tableCell","header":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Units","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"bsniCGbXIf"}],"key":"ebDf1IIQXt"}],"key":"hrrnomwL2d"},{"type":"tableRow","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"emphasis","children":[{"type":"text","value":"rsus","key":"z0ACn9UC6q"}],"key":"m3ioZebUqS"}],"key":"GUW7BkxMHE"},{"type":"tableCell","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"The upwelling shortwave radiation at the surface","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"k9ev2o8OS9"}],"key":"EazuvX3siK"},{"type":"tableCell","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"W/m","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"nV0xf6msj0"},{"type":"inlineMath","value":"^2","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mrow></mrow><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">^2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span>","key":"tmZe2YIIp6"}],"key":"ePgCqYLdQk"}],"key":"gXjb34MUIl"},{"type":"tableRow","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"emphasis","children":[{"type":"text","value":"rsds","key":"WvT2D9JtPO"}],"key":"yWYrPpy5yy"}],"key":"QF37Hr20qh"},{"type":"tableCell","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"The downwelling shortwave radiation at the surface","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"PXlBL4371U"}],"key":"xoWoDgFkIG"},{"type":"tableCell","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"W/m","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"aY43k6n8zD"},{"type":"inlineMath","value":"^2","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mrow></mrow><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">^2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span>","key":"hwjavy1nn7"}],"key":"nXtULyYPIY"}],"key":"U2fuMV2caI"}],"key":"rCOAP9lp8l"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"DmwsPx46k1"},{"type":"link","url":"https://tyfolino.github.io/climkern/climkern.html#climkern.calc_alb_feedback","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"inlineCode","value":"calc_alb_feedback()","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"owDUT8dF8p"}],"urlSource":"https://tyfolino.github.io/climkern/climkern.html#climkern.calc_alb_feedback","key":"dK28vUYKZ3"},{"type":"text","value":" function is straightforward. Be sure to include our kernel name\nin the arguments.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"hK722VwBo3"}],"key":"ZQLZTx7u7z"}],"key":"TVA97a14AG"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"alb = ck.calc_alb_feedback(\n    ctrl.rsus,ctrl.rsds,pert.rsus,pert.rsds,kern=\"ERA5\"\n)","key":"pdU03CZl1W"},{"type":"output","id":"EW41z5d_KNqtcTIxM6aV3","data":[],"key":"gathX8MLNK"}],"key":"Az5kVsUNb0"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Let’s see what the resulting Dataarray looks like.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WRqb1mXyqU"}],"key":"s12Z3Ji2uz"}],"key":"hNb81BcsS4"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"alb","key":"DuOnXXe3MX"},{"type":"output","id":"6OS598w_wEvKZzdg1AuBc","data":[],"key":"ioqiLQmEBX"}],"key":"vUZ1wbFpH0"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Finally, let’s plot the time average surface albedo feedback on a map, first as just the perturbation.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rbcx31TJLx"}],"key":"omIt12AEA8"}],"key":"xwtoORiRxJ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Set a few variables\nproj = ccrs.Robinson()\n\n# Create figure and axis\nfig, ax = plt.subplots(subplot_kw=dict(projection=proj),\n                       layout=\"constrained\")\n\n# Plot surface albedo feedback & add coastlines\nalb.mean(dim=\"time\").plot(ax=ax,transform=ccrs.PlateCarree(),\n                         cbar_kwargs={\"orientation\": \"horizontal\", \"shrink\": 0.7,\n                                      \"label\":\"W/m$^2$\"})\nax.coastlines()\n\n# Add a title\nax.set_title(\"Time-averaged Surface Albedo Feedback\")\n\nplt.show()","key":"grDJmqwIIm"},{"type":"output","id":"MeYc27VJuXGGHQ0WzdEnE","data":[],"key":"Oxgrg658SP"}],"key":"bgVQNaxCsV"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now normalized by the surface temperature change...","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pjgFW96tZq"}],"key":"OUmju6Y6su"}],"key":"R0zO47REMh"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Set a few variables\nproj = ccrs.Robinson()\n\n# Create figure and axis\nfig, ax = plt.subplots(subplot_kw=dict(projection=proj),\n                       layout=\"constrained\")\n\n# Plot surface albedo feedback & add coastlines\n(alb.mean(dim=\"time\")/Δts.mean(dim=\"time\")).plot(ax=ax,transform=ccrs.PlateCarree(),\n                         cbar_kwargs={\"orientation\": \"horizontal\", \"shrink\": 0.7,\n                                      \"label\":\"W/m$^2$/K\"})\nax.coastlines()\n\n# Add a title\nax.set_title(\"Time-averaged Surface Albedo Feedback\")\n\nplt.show()","key":"AzPNmwcyoe"},{"type":"output","id":"CRUBtkQ3oXLMeanc_r8WX","data":[],"key":"wcIFkhlh9T"}],"key":"aeOaBQtiSO"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"As one might expect, the greatest radiative change at the TOA from the surface albedo feedback is near the poles where there is melting sea ice and snow.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OjRWHgbT1A"}],"key":"pTHVvB4KAW"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Let’s end by calculating the global average. ClimKern comes with a ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"occReAqsSZ"},{"type":"link","url":"https://tyfolino.github.io/climkern/climkern.html#climkern.spat_avg","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"inlineCode","value":"spat_avg()","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"bCKdLKPUq5"}],"urlSource":"https://tyfolino.github.io/climkern/climkern.html#climkern.spat_avg","key":"IMVgD1487D"},{"type":"text","value":" function.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"RFWfdffyRf"}],"key":"WtUWDFpfCv"}],"key":"rZ202nSKsR"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Output the time-averaged global surface albedo feedback\noutput = \"The global average surface albedo feedback is {value:.2f} W/m\\u00b2/K.\"\nprint(output.format(value=float(ck.spat_avg((alb.mean(dim=\"time\")/Δts.mean(dim=\"time\")\n                                         ).expand_dims(\"time\")))))","key":"Y2culaanLa"},{"type":"output","id":"gPKvrFlj6rSEqqXewHAG9","data":[],"key":"nOc0AU7gHd"}],"key":"dthNfrVgk8"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Planck and lapse rate feedbacks","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PiGqeyJYwp"}],"identifier":"planck-and-lapse-rate-feedbacks","label":"Planck and lapse rate feedbacks","html_id":"planck-and-lapse-rate-feedbacks","implicit":true,"key":"V1nSK7gQEw"}],"key":"lY1p91v2Pv"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"As a reminder, the total tropospheric temperature feedback is often decomposed into a distict Planck and lapse rate feedback. ClimKern has a single function that produces both feedbacks simultaneously called ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NqCwDSHlCt"},{"type":"link","url":"https://tyfolino.github.io/climkern/climkern.html#climkern.calc_T_feedbacks","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"inlineCode","value":"calc_T_feedbacks()","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VnBmHWTJcu"}],"urlSource":"https://tyfolino.github.io/climkern/climkern.html#climkern.calc_T_feedbacks","key":"ejIylN9Vfh"},{"type":"text","value":". The variables we need this time are:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Rb2L9GE8gO"}],"key":"vGwg87kkqz"},{"type":"table","position":{"start":{"line":3,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"tableRow","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"tableCell","header":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Variable name","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jmrzy06LwE"}],"key":"EZcyU0eWBI"},{"type":"tableCell","header":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Description","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"prpWd7kac0"}],"key":"UdBhn5uuqR"},{"type":"tableCell","header":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Units","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"vjB3OHoVjs"}],"key":"lJ3NABl4ZW"},{"type":"tableCell","header":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Notes","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"kIyWwIgRTa"}],"key":"lGLTwMK4IM"}],"key":"wAW2od39fQ"},{"type":"tableRow","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"emphasis","children":[{"type":"text","value":"ta","key":"LzkkSmVDl8"}],"key":"jSxSl3cZJC"}],"key":"YbCunOtmaU"},{"type":"tableCell","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"The 4-dimensional air temperature","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"zN80uJh9kf"}],"key":"NJQvr6rEq2"},{"type":"tableCell","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"K","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"kWpd9SXKXi"}],"key":"Ho27Kd6Gmw"},{"type":"tableCell","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[],"key":"vq2RJaDE9g"}],"key":"Zr2AnJMcoy"},{"type":"tableRow","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"emphasis","children":[{"type":"text","value":"ts","key":"vqtBV1qeS7"}],"key":"VFbaC8UUOI"}],"key":"wACmgUkVko"},{"type":"tableCell","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"The 3-dimensional surface skin temperature","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"JoQCRhwHji"}],"key":"mifVBtSFN1"},{"type":"tableCell","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"K","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"IS68IxaAdu"}],"key":"ZkQgUZXnqJ"},{"type":"tableCell","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[],"key":"o3ocCU8aXf"}],"key":"VpeQsVmver"},{"type":"tableRow","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"emphasis","children":[{"type":"text","value":"ps","key":"YUJ9f187OC"}],"key":"WtHkZ7ITca"}],"key":"iUQeUjCUaR"},{"type":"tableCell","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"The 3-dimensional surface pressure","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"UlHxIyTkFr"}],"key":"UOKJPxj61N"},{"type":"tableCell","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Pa, mb, or hPa","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"AhZfL1t9T8"}],"key":"LaoR3loLzy"},{"type":"tableCell","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[],"key":"a60SN31vY7"}],"key":"yOR6b7cCHX"},{"type":"tableRow","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"emphasis","children":[{"type":"text","value":"trop_p","key":"x6tGHi43rG"}],"key":"eTj1UhALwz"}],"key":"KS5IUHw4nW"},{"type":"tableCell","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"The 3-dimensional tropopause height","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"yqBCxFUN7t"}],"key":"Lk90UNSPAR"},{"type":"tableCell","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Pa, mb, or hPa","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"VZ8mTCfkkS"}],"key":"ucVKhUAg5J"},{"type":"tableCell","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"emphasis","children":[{"type":"text","value":"Optional","key":"v0V7mXfaC2"}],"key":"fzin2jjBZI"}],"key":"q6JmVsot52"}],"key":"RMtvYbqA8R"}],"key":"f1w2qZY7kF"},{"type":"paragraph","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"CMIP6 output rarely contains the tropopause height, so we will create a default tropopause that decreases linearly with the cosine of latitude from 100 hPa at the Equator to 300 hPa at the poles.","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"w9E5QkoGc9"}],"key":"Kfv0njYQyj"}],"key":"Y6Z6NxZm9F"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Use ClimKern's \"hidden\" make_tropo function\npert[\"trop_p\"] = ck.util.make_tropo(pert.ps)\npert.trop_p.attrs[\"units\"] = \"Pa\"\n\nlr,pl = ck.calc_T_feedbacks(\n    ctrl.ta,ctrl.ts,ctrl.ps,pert.ta,pert.ts,pert.ps,pert_trop=pert.trop_p,kern=\"ERA5\"\n)","key":"EcVDx7g2Uf"},{"type":"output","id":"-X5EaO9L3nbVQzoMp7d55","data":[],"key":"iqkO7ZNnxi"}],"key":"oNUEcokqWv"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Simple. Let’s see what it looks like.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QnKKu8fSlb"}],"key":"GUK3pURNHe"}],"key":"e0Gx0LQtYT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Set a few variables\nproj = ccrs.Robinson()\n\n# Create figure and axis\nfig, ax = plt.subplots(subplot_kw=dict(projection=proj),\n                       layout=\"constrained\")\n\n# Plot surface albedo feedback & add coastlines\nlr.mean(dim=\"time\").plot(ax=ax,transform=ccrs.PlateCarree(),\n                         cbar_kwargs={\"orientation\": \"horizontal\", \"shrink\": 0.7,\n                                      \"label\":\"W/m$^2$\"})\nax.coastlines()\n\n# Add a title\nax.set_title(\"Time-averaged Lapse Rate Feedback\")\n\nplt.show()","key":"KbJhQlDJx9"},{"type":"output","id":"9kodNrPmmYQNtIZYfVYfx","data":[],"key":"pvYD4ZagM5"}],"key":"yzqTQjK726"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Set a few variables\nproj = ccrs.Robinson()\n\n# Create figure and axis\nfig, ax = plt.subplots(subplot_kw=dict(projection=proj),\n                       layout=\"constrained\")\n\n# Plot surface albedo feedback & add coastlines\n(lr.mean(dim=\"time\")/Δts.mean(dim=\"time\")).plot(ax=ax,transform=ccrs.PlateCarree(),\n                         cbar_kwargs={\"orientation\": \"horizontal\", \"shrink\": 0.7,\n                                      \"label\":\"W/m$^2$/K\"})\nax.coastlines()\n\n# Add a title\nax.set_title(\"Time-averaged Lapse Rate Feedback\")\n\nplt.show()","key":"ApPPItZbJM"},{"type":"output","id":"_5d11YfMRW_5MHS42t1om","data":[],"key":"GFdua5SpWe"}],"key":"oOhJ04ZK5V"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Set a few variables\nproj = ccrs.Robinson()\n\n# Create figure and axis\nfig, ax = plt.subplots(subplot_kw=dict(projection=proj),\n                       layout=\"constrained\")\n\n# Plot surface albedo feedback & add coastlines\npl.mean(dim=\"time\").plot(ax=ax,transform=ccrs.PlateCarree(),cmap=\"Blues_r\",\n                         cbar_kwargs={\"orientation\": \"horizontal\", \"shrink\": 0.7,\n                                      \"label\":\"W/m$^2$\"})\nax.coastlines()\n\n# Add a title\nax.set_title(\"Time-averaged Planck Feedback\")\n\nplt.show()","key":"tfsv44VL6v"},{"type":"output","id":"yEx-9-z7AWfx-TW6OT7Qw","data":[],"key":"yWqWkvtPvz"}],"key":"HOSkE4aFUe"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Set a few variables\nproj = ccrs.Robinson()\n\n# Create figure and axis\nfig, ax = plt.subplots(subplot_kw=dict(projection=proj),\n                       layout=\"constrained\")\n\n# Plot surface albedo feedback & add coastlines\n(pl.mean(dim=\"time\")/Δts.mean(dim=\"time\")).plot(\n    ax=ax,transform=ccrs.PlateCarree(),cmap=\"Blues_r\",\n    cbar_kwargs={\"orientation\": \"horizontal\", \"shrink\": 0.7,\"label\":\"W/m$^2$\"}\n)\nax.coastlines()\n\n# Add a title\nax.set_title(\"Time-averaged Planck Feedback\")\n\nplt.show()","key":"mi9usOgWwT"},{"type":"output","id":"8U6uguw-F-BG2MNpB1qK4","data":[],"key":"tVYWMieskm"}],"key":"ZhKun3CULt"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"These results seem reasonable. The Planck feedback is often the feedback with the largest magnitude and scales nonlinearly with temperature change. The lapse rate feedback changes sign depending on the vertical structure of the atmosphere is usually positive (warming) at the poles and negative (cooling) in the tropics.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CnzpCzxnel"}],"key":"zd3LHFl3b6"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Let’s get those global averages again!","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"cCr7p4EI7J"}],"key":"juZSGzqcrU"}],"key":"saGzgPG12J"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Output the time-averaged global temperature feedbacks\noutput = (\"The global average lapse rate and Planck feedbacks are\"+\n          \" {lr:.2f} and {pl:.2f} W/m\\u00b2/K, respectively.\")\nprint(output.format(lr=float(ck.spat_avg((lr.mean(dim=\"time\")/Δts.mean(dim=\"time\")\n                                         ).expand_dims(\"time\"))),\n                   pl=float(ck.spat_avg((pl.mean(dim=\"time\")/Δts.mean(dim=\"time\")\n                                        ).expand_dims(\"time\")))))","key":"t3GBYc7DGH"},{"type":"output","id":"lAWihlMZk_BJPYWMZBHKT","data":[],"key":"TWqLOKS97O"}],"key":"CbtoeWiQ7D"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Water vapor feedbacks","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iaujiWeSh6"}],"identifier":"water-vapor-feedbacks","label":"Water vapor feedbacks","html_id":"water-vapor-feedbacks","implicit":true,"key":"ohM9BkxoNk"}],"key":"jMIfQwrpAZ"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Here we use ClimKern to calculate the longwave and shortwave water vapor feedabcks. ClimKern has a single function that produces both called ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vGBp8i1oKx"},{"type":"link","url":"https://tyfolino.github.io/climkern/climkern.html#climkern.calc_q_feedbacks","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"inlineCode","value":"calc_q_feedbacks()","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"r16Bt0lVde"}],"urlSource":"https://tyfolino.github.io/climkern/climkern.html#climkern.calc_q_feedbacks","key":"X4p8ZLjsDk"},{"type":"text","value":". This function requires both the specific humidity and air temperature because ClimKern has to normalize the water vapor kernels to make them compatible with the specific humidity.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tJnIKuIM1E"}],"key":"SjsQAoGzLQ"},{"type":"table","position":{"start":{"line":3,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"tableRow","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"tableCell","header":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Variable name","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"pqf3cTaDBW"}],"key":"SiEm3PHNZR"},{"type":"tableCell","header":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Description","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"fUjibZwRvm"}],"key":"maajvdhfIp"},{"type":"tableCell","header":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Units","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"RMBwfhNYT7"}],"key":"pPV8qAwtYL"},{"type":"tableCell","header":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Notes","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"K1EaGGFhu3"}],"key":"ERTpJwnfoc"}],"key":"i1f1t3nUGU"},{"type":"tableRow","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"emphasis","children":[{"type":"text","value":"hus","key":"yQeQtY0NAO"}],"key":"EjbbrRVk8Z"}],"key":"jJcyENMdWH"},{"type":"tableCell","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"The 4-dimensional specific humidity","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"bYycNelGHY"}],"key":"eOfhGgr97R"},{"type":"tableCell","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"inlineMath","value":"\\frac{g}{g}","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mi>g</mi><mi>g</mi></mfrac></mrow><annotation encoding=\"application/x-tex\">\\frac{g}{g}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.2286em;vertical-align:-0.4811em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7475em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">g</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.4461em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">g</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.4811em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span>","key":"y6i9Dan1kd"},{"type":"text","value":" or ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"E0Yft55Eup"},{"type":"inlineMath","value":"\\frac{g}{kg}","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mi>g</mi><mrow><mi>k</mi><mi>g</mi></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">\\frac{g}{kg}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.2286em;vertical-align:-0.4811em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7475em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">g</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.4461em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">g</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.4811em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span>","key":"YTj13qKvpI"}],"key":"z7EaFqJ2uf"},{"type":"tableCell","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[],"key":"fpjEV2qe0I"}],"key":"kySi0E4zH5"},{"type":"tableRow","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"emphasis","children":[{"type":"text","value":"ta","key":"Cwbk2JXWb0"}],"key":"tvIrRUXd7C"}],"key":"OlFXqS3I4Y"},{"type":"tableCell","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"The 4-dimensional air temperature","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"juIJ1KwCY3"}],"key":"LTaE1idao1"},{"type":"tableCell","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"K","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"b58q4XSCDa"}],"key":"WaAzZRDh9p"},{"type":"tableCell","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[],"key":"GltXlbL6zs"}],"key":"mpYMfDu8LB"},{"type":"tableRow","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"emphasis","children":[{"type":"text","value":"ps","key":"czoDHCe1Av"}],"key":"QW1Mrnt07u"}],"key":"nuQpMq1odq"},{"type":"tableCell","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"The 3-dimensional surface pressure","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"De4EFNjGmt"}],"key":"dLCUWozusS"},{"type":"tableCell","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Pa, mb, or hPa","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"KXPyXBs18U"}],"key":"r6inGY9bkw"},{"type":"tableCell","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[],"key":"Ig4KKQNjbl"}],"key":"JYKF20pTvq"},{"type":"tableRow","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"emphasis","children":[{"type":"text","value":"trop_p","key":"qX3CtCOkME"}],"key":"cXOw4rVE2j"}],"key":"T5xnXZYiMb"},{"type":"tableCell","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"The 3-dimensional tropopause height","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"vV6uoUR1Gn"}],"key":"XnySFySgSn"},{"type":"tableCell","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Pa, mb, or hPa","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"aM7NZNiIxH"}],"key":"Up6KKyKexH"},{"type":"tableCell","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"emphasis","children":[{"type":"text","value":"Optional","key":"cIUAPUMVcO"}],"key":"BqDaFM4DaI"}],"key":"MxuVf8v7qO"}],"key":"fHKbIq37Lo"}],"key":"MsvVfr5KTH"},{"type":"paragraph","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"There is one more argument we can provide called ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"PpSSGYwjf9"},{"type":"inlineCode","value":"method","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"FYuIDPbnBz"},{"type":"text","value":", which is simply a number 1-4. This corresponds to whether to use a fractional approximation for logarithms, use the logarithms explicitly, or use the linear change in water vapor concentration. See ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"EDeLefbeEZ"},{"type":"link","url":"https://tyfolino.github.io/climkern/climkern.html#climkern.calc_q_feedbacks","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"here","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"AUsD68IJJo"}],"urlSource":"https://tyfolino.github.io/climkern/climkern.html#climkern.calc_q_feedbacks","key":"lMlkrbXPFb"},{"type":"text","value":" for complete descriptions. We will use method 3 which is to use the natural logarithm of specific humidity without doing a fractional approximation.","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"g2qyp2dHGl"}],"key":"Y0wpzDN0Xi"},{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"We will use the same tropopause height as before.","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"vsubjZo4c6"}],"key":"ILZmQP50U2"}],"key":"oLyYJSRBtA"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Use ClimKern's water vapor feedback function\nqlw,qsw = ck.calc_q_feedbacks(\n    ctrl.hus,ctrl.ta,ctrl.ps,pert.hus,pert.ps,pert_trop=pert.trop_p,kern=\"ERA5\",\n    method=3\n)","key":"AuAsof7Eho"},{"type":"output","id":"ofGd-KDK8-i2_iBfR8VR-","data":[],"key":"WxEo2nCvpx"}],"key":"w8ulHKCCqo"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Let’s take a look, starting with the longwave.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XyvCWNXWSA"}],"key":"BBz2W6W47i"}],"key":"lHF6FZ2OOb"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Set a few variables\nproj = ccrs.Robinson()\n\n# Create figure and axis\nfig, ax = plt.subplots(subplot_kw=dict(projection=proj),\n                       layout=\"constrained\")\n\n# Plot the longwave water vapor feedback and add coastlines\nqlw.mean(dim=\"time\").plot(ax=ax,transform=ccrs.PlateCarree(),cmap=\"Reds\",\n                         cbar_kwargs={\"orientation\": \"horizontal\", \"shrink\": 0.7,\n                                      \"label\":\"W/m$^2$\"})\nax.coastlines()\n\n# Add a title\nax.set_title(\"Time-averaged LW Water Vapor Feedback\")\n\nplt.show()","key":"yilK3TUEHU"},{"type":"output","id":"tujMqwpdWME6H7lro5_W2","data":[],"key":"PFgytZaUWO"}],"key":"aHUxhdBOLd"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Set a few variables\nproj = ccrs.Robinson()\n\n# Create figure and axis\nfig, ax = plt.subplots(subplot_kw=dict(projection=proj),\n                       layout=\"constrained\")\n\n# Plot the longwave water vapor feedback and add coastlines\n(qlw.mean(dim=\"time\")/Δts.mean(dim=\"time\")).plot(\n    ax=ax,transform=ccrs.PlateCarree(),cmap=\"Reds\",\n    cbar_kwargs={\"orientation\": \"horizontal\", \"shrink\": 0.7,\n                 \"label\":\"W/m$^2$/K\"}\n)\nax.coastlines()\n\n# Add a title\nax.set_title(\"Time-averaged LW Water Vapor Feedback\")\n\nplt.show()","key":"YIyoKSXwW6"},{"type":"output","id":"3h2sGaXsiP89hE6tjyiJ2","data":[],"key":"yx6jCrYgrK"}],"key":"WPkHQr9PZJ"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"And now the shortwave...","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"STv0w37H8R"}],"key":"bDJrkvLrOd"}],"key":"vAfBKkUsSn"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Set a few variables\nproj = ccrs.Robinson()\n\n# Create figure and axis\nfig, ax = plt.subplots(subplot_kw=dict(projection=proj),\n                       layout=\"constrained\")\n\n# Plot the longwave water vapor feedback and add coastlines\nqsw.mean(dim=\"time\").plot(ax=ax,transform=ccrs.PlateCarree(),cmap=\"Reds\",\n                         cbar_kwargs={\"orientation\": \"horizontal\", \"shrink\": 0.7,\n                                      \"label\":\"W/m$^2$\"})\nax.coastlines()\n\n# Add a title\nax.set_title(\"Time-averaged SW Water Vapor Feedback\")\n\nplt.show()","key":"J674qwdTzX"},{"type":"output","id":"D2fLG84ceQXe5g8nlNqmG","data":[],"key":"xSq90IMnKR"}],"key":"TYZOpJW1hD"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Set a few variables\nproj = ccrs.Robinson()\n\n# Create figure and axis\nfig, ax = plt.subplots(subplot_kw=dict(projection=proj),\n                       layout=\"constrained\")\n\n# Plot the longwave water vapor feedback and add coastlines\n(qsw.mean(dim=\"time\")/Δts.mean(dim=\"time\")).plot(\n    ax=ax,transform=ccrs.PlateCarree(),cmap=\"Reds\",\n                         cbar_kwargs={\"orientation\": \"horizontal\", \"shrink\": 0.7,\n                                      \"label\":\"W/m$^2$/K\"}\n)\nax.coastlines()\n\n# Add a title\nax.set_title(\"Time-averaged SW Water Vapor Feedback\")\n\nplt.show()","key":"FCBGN28MIy"},{"type":"output","id":"uCFDEgnh8uDjGCLahTyWE","data":[],"key":"KYDjRY4MmS"}],"key":"Js4mhxRnBH"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Output the time-averaged global surface albedo feedback\noutput = (\"The global average longwave and shortwave water vapor feedbacks are\"+\n          \" {lw:.2f} and {sw:.2f} W/m\\u00b2/K, respectively.\")\nprint(output.format(lw=float(ck.spat_avg((qlw.mean(dim=\"time\")/Δts.mean(dim=\"time\")\n                                         ).expand_dims(\"time\"))),\n                   sw=float(ck.spat_avg((qsw.mean(dim=\"time\")/Δts.mean(dim=\"time\")\n                                        ).expand_dims(\"time\")))))","key":"ENm4ADPei6"},{"type":"output","id":"eE0NE-byfGx3ndFE4_0Za","data":[],"key":"Iq5Eodnx32"}],"key":"PayNE7diG6"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Cloud feedbacks","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Wl3tqwzeru"}],"identifier":"cloud-feedbacks","label":"Cloud feedbacks","html_id":"cloud-feedbacks","implicit":true,"key":"GSIvDlRhew"}],"key":"Sz38uOpsgX"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Download radiative forcing","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ohSZiJr77a"}],"identifier":"download-radiative-forcing","label":"Download radiative forcing","html_id":"download-radiative-forcing","implicit":true,"key":"kAEvKhQP1d"}],"key":"h4qVruNIvZ"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"It’s time for cloud feedbacks. However, like anything to do with clouds, there are some complications. You ideally need the effective radiative forcing (ERF), which is a measure of radiative imbalance imposed by CO","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"hsBriOE2dR"},{"type":"inlineMath","value":"_2","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow></mrow><mn>2</mn></msub></mrow><annotation encoding=\"application/x-tex\">_2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4511em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"UujCBC6Xal"},{"type":"text","value":" in the absence of surface temperature change ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EsSqEfUWhv"},{"type":"cite","url":"https://doi.org/10.5194/acp-20-9591-2020","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Smith et al., 2020","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NOSUaC9m46"}],"kind":"narrative","label":"Smith_2020","identifier":"https://doi.org/10.5194/acp-20-9591-2020","enumerator":"1","key":"MYukVaAIBl"},{"type":"text","value":". Thankfully, CESM2 radiative forcing for our scenarios is available on the Google cloud.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mRRR96b8oK"}],"key":"rDGEp1jtml"}],"key":"GOY9Lw8Gxm"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Specify data location, open it\ncat_url = \"https://storage.googleapis.com/cmip6/pangeo-cmip6.json\"\ncol = intake.open_esm_datastore(cat_url)\n\n# # Create a catalog of matching simulations\ncat = col.search(activity_id=\"RFMIP\",source_id=\"CESM2\",experiment_id=[\"piClim-4xCO2\",\n                                                                      \"piClim-control\"],\n                variable_id=[\"rlut\",\"rsut\",\"rsdt\"])\n\n# Convert to a dictionary of Xarray Datasets\nds_dict = cat.to_dataset_dict(zarr_kwargs={'consolidated': True})\n\n# Assign Datasets to variables\nrf_ctrl = ds_dict[\"RFMIP.NCAR.CESM2.piClim-control.Amon.gn\"]\nrf_pert = ds_dict[\"RFMIP.NCAR.CESM2.piClim-4xCO2.Amon.gn\"]","key":"zGog6fIE4l"},{"type":"output","id":"wmTTzvGpSCqnZJ_qA7xFR","data":[],"key":"yjsdxsbOzA"}],"key":"Wy9YEJqy4t"},{"type":"block","kind":"notebook-content","children":[{"type":"div","class":"admonition alert alert-info","children":[{"type":"paragraph","children":[{"type":"text","value":"Info","key":"nfD1MVyIPV"}],"key":"sYZUrSutQY"},{"type":"text","value":"Your relevant information here!","key":"Lwiau5nvJn"}],"key":"NS7M8tRKrT"}],"key":"KaAXaJqcv5"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Feel free to copy this around and edit or play around with yourself. Some other ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yQ09wqUBN9"},{"type":"inlineCode","value":"admonitions","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"d7LcRbWfG6"},{"type":"text","value":" you can put in:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VLwHWTsyIs"}],"key":"BQCwBehOws"}],"key":"TJOlq9MgfD"},{"type":"block","kind":"notebook-content","children":[{"type":"div","class":"admonition alert alert-success","children":[{"type":"paragraph","children":[{"type":"text","value":"Success","key":"IGuDRCZ3v9"}],"key":"SAYTpeW3UK"},{"type":"text","value":"We got this done after all!","key":"yvBxjLNmDq"}],"key":"gctDLQnR11"}],"key":"TmW2sgetZ9"},{"type":"block","kind":"notebook-content","children":[{"type":"div","class":"admonition alert alert-warning","children":[{"type":"paragraph","children":[{"type":"text","value":"Warning","key":"woqRE5MXkP"}],"key":"TSuVLXcoE1"},{"type":"text","value":"Be careful!","key":"G6XS16lVh8"}],"key":"CTnfJDElJg"}],"key":"tX6GGGOeiV"},{"type":"block","kind":"notebook-content","children":[{"type":"div","class":"admonition alert alert-danger","children":[{"type":"paragraph","children":[{"type":"text","value":"Danger","key":"HAKc3C8syF"}],"key":"ZrUMsqvri2"},{"type":"text","value":"Scary stuff be here.","key":"OSAU5VaRvz"}],"key":"Iu8ThobsEW"}],"key":"ODkO0mRJ6G"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We also suggest checking out Jupyter Book’s ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RbX9IHtOPC"},{"type":"link","url":"https://jupyterbook.org/content/metadata.html#jupyter-cell-tags","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"brief demonstration","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AtId3rMzr8"}],"urlSource":"https://jupyterbook.org/content/metadata.html#jupyter-cell-tags","key":"gDotdWvLc1"},{"type":"text","value":" on adding cell tags to your cells in Jupyter Notebook, Lab, or manually. Using these cell tags can allow you to ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"oCCNwOMeiD"},{"type":"link","url":"https://jupyterbook.org/interactive/hiding.html","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"customize","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cS948YQjBH"}],"urlSource":"https://jupyterbook.org/interactive/hiding.html","key":"FTPG9BgorA"},{"type":"text","value":" how your code content is displayed and even ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pf8L0lWYWq"},{"type":"link","url":"https://jupyterbook.org/content/execute.html#dealing-with-code-that-raises-errors","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"demonstrate errors","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VjZPkGTXsX"}],"urlSource":"https://jupyterbook.org/content/execute.html#dealing-with-code-that-raises-errors","key":"fAsd1JBHbX"},{"type":"text","value":" without altogether crashing our loyal army of machines!","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"S02GWEHPU8"}],"key":"kEnYc57GdV"}],"key":"mU9jH8PHoc"},{"type":"block","kind":"notebook-content","children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WftN1XANtX"}],"key":"kZnBe9tR5K"}],"key":"uoTGI6NU8M"},"references":{"cite":{"order":["Smith_2020"],"data":{"Smith_2020":{"label":"Smith_2020","enumerator":"1","doi":"10.5194/acp-20-9591-2020","html":"Smith, C. J., Kramer, R. J., Myhre, G., Alterskjær, K., Collins, W., Sima, A., Boucher, O., Dufresne, J.-L., Nabat, P., Michou, M., Yukimoto, S., Cole, J., Paynter, D., Shiogama, H., O’Connor, F. M., Robertson, E., Wiltshire, A., Andrews, T., Hannay, C., … Forster, P. M. (2020). Effective radiative forcing and adjustments in CMIP6 models. <i>Atmospheric Chemistry and Physics</i>, <i>20</i>(16), 9591–9618. <a target=\"_blank\" rel=\"noreferrer\" href=\"https://doi.org/10.5194/acp-20-9591-2020\">10.5194/acp-20-9591-2020</a>","url":"https://doi.org/10.5194/acp-20-9591-2020"}}}},"footer":{"navigation":{"prev":{"title":"APRP","url":"/notebooks/feedback-analysis/aprp","group":"Feedback Analysis"},"next":{"title":"Comparing Different Kernels","url":"/notebooks/simplified-calc/kernel-comparison","group":"Simplifying Calculations"}}},"domain":"http://localhost:3000"}